<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Balancing Chemical Equations - Mustafa Abdul Haque</title>
  <link rel="icon" type="image/svg+xml" href="logos/ICON ONLY Mustafa Abdul Haque (Logo).svg">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Page-specific styles */
    .equation-display {
      font-size: 1.25rem;
      padding: 1rem;
      background: var(--color-white);
      border-radius: var(--radius-sm);
      margin: 1rem 0;
      text-align: center;
      border: 1px solid var(--color-light-gray);
    }

    .equation-display .arrow {
      margin: 0 0.5rem;
    }

    .step-box {
      background: var(--color-white);
      border-radius: var(--radius-sm);
      padding: 1.25rem;
      margin: 1rem 0;
      border-left: 4px solid var(--color-medium-green);
    }

    .step-box h4 {
      color: var(--color-dark-green);
      margin-bottom: 0.75rem;
      font-family: var(--font-heading);
    }

    .step-box ul {
      margin: 0.5rem 0;
      padding-left: 1.25rem;
    }

    .step-box li {
      margin: 0.25rem 0;
    }

    .math-display {
      text-align: center;
      padding: 0.75rem;
      background: rgba(163, 143, 90, 0.1);
      border-radius: var(--radius-sm);
      margin: 0.75rem 0;
      font-family: 'Times New Roman', serif;
      font-size: 1.1rem;
    }

    .coefficient-input {
      width: 50px;
      padding: 0.4rem;
      text-align: center;
      font-size: 1.1rem;
      border: 2px solid var(--color-light-gray);
      border-radius: var(--radius-sm);
      margin: 0 0.25rem;
    }

    .coefficient-input:focus {
      border-color: var(--color-medium-green);
      outline: none;
    }

    .equation-workspace {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--color-white);
      border-radius: var(--radius-sm);
      margin: 1rem 0;
    }

    .equation-workspace span {
      font-size: 1.2rem;
    }

    .buttons {
      margin-top: 1rem;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .blank-input {
      width: 80px;
      padding: 0.3rem 0.5rem;
      text-align: center;
      font-size: 1rem;
      border: 2px dashed var(--color-medium-green);
      border-radius: var(--radius-sm);
      background: rgba(76, 107, 60, 0.05);
    }

    .blank-input:focus {
      border-style: solid;
      outline: none;
    }

    .atom-count-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.95rem;
    }

    .atom-count-table th,
    .atom-count-table td {
      border: 1px solid var(--color-light-gray);
      padding: 0.5rem;
      text-align: center;
    }

    .atom-count-table th {
      background: var(--color-dark-green);
      color: white;
    }

    .atom-count-table tr:nth-child(even) {
      background: rgba(76, 107, 60, 0.05);
    }

    .example-card {
      background: var(--color-white);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      margin: 1.5rem 0;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-light-gray);
    }

    .example-card h3 {
      color: var(--color-dark-green);
      border-bottom: 2px solid var(--color-gold);
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }

    .final-answer {
      background: rgba(163, 143, 90, 0.2);
      padding: 0.75rem 1rem;
      border-radius: var(--radius-sm);
      text-align: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--color-dark-green);
      border: 2px solid var(--color-gold);
      margin-top: 1rem;
    }

    .subscript {
      font-size: 0.75em;
      vertical-align: sub;
    }

    @media (max-width: 600px) {
      .coefficient-input {
        width: 40px;
      }

      .blank-input {
        width: 60px;
      }

      .equation-workspace span {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-content">
      <a href="index.html" class="site-logo">
        <img src="logos/Mustafa Abdul Haque.svg" alt="Mustafa Abdul Haque">
      </a>
      <nav class="site-nav">
        <a href="index.html">Home</a>
        <a href="chemistry-balancing.html" class="active">Chemistry Balancing</a>
        <a href="chemistry-key-equations.html">Chemistry Equations</a>
        <a href="dimensional-analysis.html">Dimensional Analysis</a>
        <a href="ipa-learning-app.html">IPA Learning</a>
      </nav>
    </div>
  </header>

  <main class="main-content">
    <div class="page-title">
      <h1>Balancing Chemical Equations</h1>
      <p class="subtitle">Master the algebraic method for balancing equations systematically</p>
    </div>

    <div class="tab-container">
      <button class="tab active" onclick="showTab('learn')">Learn the Method</button>
      <button class="tab" onclick="showTab('examples')">Worked Examples</button>
      <button class="tab" onclick="showTab('guided')">Guided Practice</button>
      <button class="tab" onclick="showTab('practice')">Independent Practice</button>
    </div>

    <!-- LEARN TAB -->
    <div id="learn" class="tab-content active">
      <div class="section-header">
        <h2>The Algebraic Method for Balancing Equations</h2>
        <p>A systematic approach using variables and equations to balance any chemical reaction.</p>
      </div>

      <div class="info-box info-box-primary mb-3">
        <strong>Why Use This Method?</strong>
        <p style="margin-top: 0.5rem;">While trial-and-error works for simple equations, the algebraic method provides a systematic approach that works for ANY equation, no matter how complex. It's especially useful for redox reactions and equations with many elements.</p>
      </div>

      <div class="step-box">
        <h4>Step 1: Assign Variables to Each Compound</h4>
        <p>Give each compound in the equation a variable (a, b, c, d, etc.) representing its coefficient.</p>
        <div class="math-display">
          Example: H<sub>2</sub> + O<sub>2</sub> → H<sub>2</sub>O becomes <em>a</em>H<sub>2</sub> + <em>b</em>O<sub>2</sub> → <em>c</em>H<sub>2</sub>O
        </div>
      </div>

      <div class="step-box">
        <h4>Step 2: Write an Equation for Each Element</h4>
        <p>For each element, count the atoms on each side (multiplied by the coefficient variable).</p>
        <ul>
          <li><strong>Hydrogen (H):</strong> Left side has 2a atoms, Right side has 2c atoms → 2a = 2c</li>
          <li><strong>Oxygen (O):</strong> Left side has 2b atoms, Right side has c atoms → 2b = c</li>
        </ul>
      </div>

      <div class="step-box">
        <h4>Step 3: Solve the System of Equations</h4>
        <p>Express all variables in terms of one "free" variable.</p>
        <ul>
          <li>From hydrogen: 2a = 2c → a = c</li>
          <li>From oxygen: 2b = c → c = 2b</li>
          <li>Substituting: a = 2b</li>
        </ul>
      </div>

      <div class="step-box">
        <h4>Step 4: Choose the Free Variable</h4>
        <p>Set the free variable to the smallest integer that makes ALL coefficients whole numbers.</p>
        <div class="math-display">
          Let b = 1, then: a = 2(1) = 2, c = 2(1) = 2
        </div>
      </div>

      <div class="step-box">
        <h4>Step 5: Write the Balanced Equation</h4>
        <p>Substitute the values back into the original equation.</p>
        <div class="final-answer">
          2H<sub>2</sub> + O<sub>2</sub> → 2H<sub>2</sub>O
        </div>
      </div>

      <div class="info-box info-box-gold mt-3">
        <strong>Verification Tip:</strong> Always check your answer by counting atoms on both sides!
        <table class="atom-count-table" style="margin-top: 0.75rem;">
          <tr>
            <th>Element</th>
            <th>Left Side</th>
            <th>Right Side</th>
            <th>Balanced?</th>
          </tr>
          <tr>
            <td>H</td>
            <td>2 × 2 = 4</td>
            <td>2 × 2 = 4</td>
            <td>Yes</td>
          </tr>
          <tr>
            <td>O</td>
            <td>1 × 2 = 2</td>
            <td>2 × 1 = 2</td>
            <td>Yes</td>
          </tr>
        </table>
      </div>
    </div>

    <!-- EXAMPLES TAB -->
    <div id="examples" class="tab-content">
      <div class="section-header">
        <h2>Worked Examples</h2>
        <p>Follow along with these step-by-step solutions to master the algebraic method.</p>
      </div>

      <div id="worked-examples"></div>
    </div>

    <!-- GUIDED PRACTICE TAB -->
    <div id="guided" class="tab-content">
      <div class="section-header">
        <h2>Guided Practice</h2>
        <p>Fill in the blanks to complete each step of the balancing process.</p>
      </div>

      <div class="info-box info-box-primary mb-3">
        <strong>Instructions:</strong> These problems guide you through the algebraic method step by step. Fill in the missing values to practice the process.
      </div>

      <div id="guided-problems"></div>
    </div>

    <!-- INDEPENDENT PRACTICE TAB -->
    <div id="practice" class="tab-content">
      <div class="section-header">
        <h2>Independent Practice</h2>
        <p>Balance these equations on your own. Click "Show Solution" to see the step-by-step process.</p>
      </div>

      <div class="info-box info-box-primary mb-3">
        <strong>Instructions:</strong> Enter the coefficients for each compound. Use 1 if no coefficient is needed. Click "Check" to verify your answer.
      </div>

      <div id="practice-problems"></div>
    </div>
  </main>

  <footer class="site-footer">
    <p>Mustafa Abdul Haque - Tutoring Resources</p>
    <p>
      <a href='https://ko-fi.com/N4N81TSGSY' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Buy Me a Coffee at ko-fi.com' /></a>
    </p>
  </footer>

<script>
// ============================================================================
// WORKED EXAMPLES DATA
// ============================================================================
const workedExamples = [
  {
    title: "Example 1: Combustion of Methane",
    unbalanced: "CH₄ + O₂ → CO₂ + H₂O",
    steps: [
      {
        name: "Step 1: Assign Variables",
        content: "aCH₄ + bO₂ → cCO₂ + dH₂O"
      },
      {
        name: "Step 2: Write Element Equations",
        equations: [
          { element: "Carbon (C)", left: "a", right: "c", equation: "a = c" },
          { element: "Hydrogen (H)", left: "4a", right: "2d", equation: "4a = 2d → 2a = d" },
          { element: "Oxygen (O)", left: "2b", right: "2c + d", equation: "2b = 2c + d" }
        ]
      },
      {
        name: "Step 3: Solve the System",
        content: "From carbon: a = c\nFrom hydrogen: d = 2a\nSubstitute into oxygen: 2b = 2a + 2a = 4a → b = 2a"
      },
      {
        name: "Step 4: Choose Free Variable",
        content: "Let a = 1:\n• c = 1\n• d = 2(1) = 2\n• b = 2(1) = 2"
      }
    ],
    balanced: "CH₄ + 2O₂ → CO₂ + 2H₂O",
    verification: [
      { element: "C", left: "1 × 1 = 1", right: "1 × 1 = 1" },
      { element: "H", left: "1 × 4 = 4", right: "2 × 2 = 4" },
      { element: "O", left: "2 × 2 = 4", right: "1 × 2 + 2 × 1 = 4" }
    ]
  },
  {
    title: "Example 2: Iron Rust Formation",
    unbalanced: "Fe + O₂ → Fe₂O₃",
    steps: [
      {
        name: "Step 1: Assign Variables",
        content: "aFe + bO₂ → cFe₂O₃"
      },
      {
        name: "Step 2: Write Element Equations",
        equations: [
          { element: "Iron (Fe)", left: "a", right: "2c", equation: "a = 2c" },
          { element: "Oxygen (O)", left: "2b", right: "3c", equation: "2b = 3c" }
        ]
      },
      {
        name: "Step 3: Solve the System",
        content: "From iron: a = 2c\nFrom oxygen: b = 3c/2"
      },
      {
        name: "Step 4: Choose Free Variable",
        content: "We need c such that b is a whole number.\nLet c = 2:\n• a = 2(2) = 4\n• b = 3(2)/2 = 3"
      }
    ],
    balanced: "4Fe + 3O₂ → 2Fe₂O₃",
    verification: [
      { element: "Fe", left: "4 × 1 = 4", right: "2 × 2 = 4" },
      { element: "O", left: "3 × 2 = 6", right: "2 × 3 = 6" }
    ]
  },
  {
    title: "Example 3: Photosynthesis",
    unbalanced: "CO₂ + H₂O → C₆H₁₂O₆ + O₂",
    steps: [
      {
        name: "Step 1: Assign Variables",
        content: "aCO₂ + bH₂O → cC₆H₁₂O₆ + dO₂"
      },
      {
        name: "Step 2: Write Element Equations",
        equations: [
          { element: "Carbon (C)", left: "a", right: "6c", equation: "a = 6c" },
          { element: "Hydrogen (H)", left: "2b", right: "12c", equation: "2b = 12c → b = 6c" },
          { element: "Oxygen (O)", left: "2a + b", right: "6c + 2d", equation: "2a + b = 6c + 2d" }
        ]
      },
      {
        name: "Step 3: Solve the System",
        content: "From carbon: a = 6c\nFrom hydrogen: b = 6c\nSubstitute into oxygen: 2(6c) + 6c = 6c + 2d\n12c + 6c = 6c + 2d\n18c = 6c + 2d\n12c = 2d → d = 6c"
      },
      {
        name: "Step 4: Choose Free Variable",
        content: "Let c = 1:\n• a = 6\n• b = 6\n• d = 6"
      }
    ],
    balanced: "6CO₂ + 6H₂O → C₆H₁₂O₆ + 6O₂",
    verification: [
      { element: "C", left: "6 × 1 = 6", right: "1 × 6 = 6" },
      { element: "H", left: "6 × 2 = 12", right: "1 × 12 = 12" },
      { element: "O", left: "6 × 2 + 6 × 1 = 18", right: "1 × 6 + 6 × 2 = 18" }
    ]
  },
  {
    title: "Example 4: Ammonia Synthesis",
    unbalanced: "N₂ + H₂ → NH₃",
    steps: [
      {
        name: "Step 1: Assign Variables",
        content: "aN₂ + bH₂ → cNH₃"
      },
      {
        name: "Step 2: Write Element Equations",
        equations: [
          { element: "Nitrogen (N)", left: "2a", right: "c", equation: "2a = c" },
          { element: "Hydrogen (H)", left: "2b", right: "3c", equation: "2b = 3c" }
        ]
      },
      {
        name: "Step 3: Solve the System",
        content: "From nitrogen: c = 2a\nSubstitute into hydrogen: 2b = 3(2a) = 6a → b = 3a"
      },
      {
        name: "Step 4: Choose Free Variable",
        content: "Let a = 1:\n• c = 2(1) = 2\n• b = 3(1) = 3"
      }
    ],
    balanced: "N₂ + 3H₂ → 2NH₃",
    verification: [
      { element: "N", left: "1 × 2 = 2", right: "2 × 1 = 2" },
      { element: "H", left: "3 × 2 = 6", right: "2 × 3 = 6" }
    ]
  }
];

// ============================================================================
// GUIDED PROBLEMS DATA (25 problems)
// ============================================================================
const guidedProblems = [
  {
    unbalanced: "H₂ + Cl₂ → HCl",
    variables: "aH₂ + bCl₂ → cHCl",
    elements: [
      { name: "H", leftExpr: "2a", rightExpr: "c", relation: "2a = c" },
      { name: "Cl", leftExpr: "2b", rightExpr: "c", relation: "2b = c" }
    ],
    solution: "a = b, c = 2a; Let a = 1: b = 1, c = 2",
    blanks: { a: "1", b: "1", c: "2" },
    balanced: "H₂ + Cl₂ → 2HCl"
  },
  {
    unbalanced: "Na + Cl₂ → NaCl",
    variables: "aNa + bCl₂ → cNaCl",
    elements: [
      { name: "Na", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "Cl", leftExpr: "2b", rightExpr: "c", relation: "2b = c" }
    ],
    solution: "a = c = 2b; Let b = 1: a = 2, c = 2",
    blanks: { a: "2", b: "1", c: "2" },
    balanced: "2Na + Cl₂ → 2NaCl"
  },
  {
    unbalanced: "Mg + O₂ → MgO",
    variables: "aMg + bO₂ → cMgO",
    elements: [
      { name: "Mg", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "O", leftExpr: "2b", rightExpr: "c", relation: "2b = c" }
    ],
    solution: "a = c = 2b; Let b = 1: a = 2, c = 2",
    blanks: { a: "2", b: "1", c: "2" },
    balanced: "2Mg + O₂ → 2MgO"
  },
  {
    unbalanced: "N₂ + O₂ → NO",
    variables: "aN₂ + bO₂ → cNO",
    elements: [
      { name: "N", leftExpr: "2a", rightExpr: "c", relation: "2a = c" },
      { name: "O", leftExpr: "2b", rightExpr: "c", relation: "2b = c" }
    ],
    solution: "2a = 2b = c; Let a = 1: b = 1, c = 2",
    blanks: { a: "1", b: "1", c: "2" },
    balanced: "N₂ + O₂ → 2NO"
  },
  {
    unbalanced: "Ca + O₂ → CaO",
    variables: "aCa + bO₂ → cCaO",
    elements: [
      { name: "Ca", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "O", leftExpr: "2b", rightExpr: "c", relation: "2b = c" }
    ],
    solution: "a = c = 2b; Let b = 1: a = 2, c = 2",
    blanks: { a: "2", b: "1", c: "2" },
    balanced: "2Ca + O₂ → 2CaO"
  },
  {
    unbalanced: "Al + O₂ → Al₂O₃",
    variables: "aAl + bO₂ → cAl₂O₃",
    elements: [
      { name: "Al", leftExpr: "a", rightExpr: "2c", relation: "a = 2c" },
      { name: "O", leftExpr: "2b", rightExpr: "3c", relation: "2b = 3c" }
    ],
    solution: "a = 2c, b = 3c/2; Let c = 2: a = 4, b = 3",
    blanks: { a: "4", b: "3", c: "2" },
    balanced: "4Al + 3O₂ → 2Al₂O₃"
  },
  {
    unbalanced: "C + O₂ → CO₂",
    variables: "aC + bO₂ → cCO₂",
    elements: [
      { name: "C", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "O", leftExpr: "2b", rightExpr: "2c", relation: "2b = 2c → b = c" }
    ],
    solution: "a = b = c; Let a = 1: b = 1, c = 1",
    blanks: { a: "1", b: "1", c: "1" },
    balanced: "C + O₂ → CO₂"
  },
  {
    unbalanced: "S + O₂ → SO₃",
    variables: "aS + bO₂ → cSO₃",
    elements: [
      { name: "S", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "O", leftExpr: "2b", rightExpr: "3c", relation: "2b = 3c" }
    ],
    solution: "a = c, b = 3c/2; Let c = 2: a = 2, b = 3",
    blanks: { a: "2", b: "3", c: "2" },
    balanced: "2S + 3O₂ → 2SO₃"
  },
  {
    unbalanced: "P + O₂ → P₂O₅",
    variables: "aP + bO₂ → cP₂O₅",
    elements: [
      { name: "P", leftExpr: "a", rightExpr: "2c", relation: "a = 2c" },
      { name: "O", leftExpr: "2b", rightExpr: "5c", relation: "2b = 5c" }
    ],
    solution: "a = 2c, b = 5c/2; Let c = 2: a = 4, b = 5",
    blanks: { a: "4", b: "5", c: "2" },
    balanced: "4P + 5O₂ → 2P₂O₅"
  },
  {
    unbalanced: "K + H₂O → KOH + H₂",
    variables: "aK + bH₂O → cKOH + dH₂",
    elements: [
      { name: "K", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "H", leftExpr: "2b", rightExpr: "c + 2d", relation: "2b = c + 2d" },
      { name: "O", leftExpr: "b", rightExpr: "c", relation: "b = c" }
    ],
    solution: "a = b = c; 2c = c + 2d → d = c/2; Let c = 2: a = 2, b = 2, d = 1",
    blanks: { a: "2", b: "2", c: "2", d: "1" },
    balanced: "2K + 2H₂O → 2KOH + H₂"
  },
  {
    unbalanced: "C₂H₆ + O₂ → CO₂ + H₂O",
    variables: "aC₂H₆ + bO₂ → cCO₂ + dH₂O",
    elements: [
      { name: "C", leftExpr: "2a", rightExpr: "c", relation: "2a = c" },
      { name: "H", leftExpr: "6a", rightExpr: "2d", relation: "6a = 2d → 3a = d" },
      { name: "O", leftExpr: "2b", rightExpr: "2c + d", relation: "2b = 2c + d" }
    ],
    solution: "c = 2a, d = 3a; 2b = 4a + 3a = 7a → b = 7a/2; Let a = 2: c = 4, d = 6, b = 7",
    blanks: { a: "2", b: "7", c: "4", d: "6" },
    balanced: "2C₂H₆ + 7O₂ → 4CO₂ + 6H₂O"
  },
  {
    unbalanced: "C₃H₈ + O₂ → CO₂ + H₂O",
    variables: "aC₃H₈ + bO₂ → cCO₂ + dH₂O",
    elements: [
      { name: "C", leftExpr: "3a", rightExpr: "c", relation: "3a = c" },
      { name: "H", leftExpr: "8a", rightExpr: "2d", relation: "8a = 2d → 4a = d" },
      { name: "O", leftExpr: "2b", rightExpr: "2c + d", relation: "2b = 2c + d" }
    ],
    solution: "c = 3a, d = 4a; 2b = 6a + 4a = 10a → b = 5a; Let a = 1: c = 3, d = 4, b = 5",
    blanks: { a: "1", b: "5", c: "3", d: "4" },
    balanced: "C₃H₈ + 5O₂ → 3CO₂ + 4H₂O"
  },
  {
    unbalanced: "Fe₂O₃ + C → Fe + CO₂",
    variables: "aFe₂O₃ + bC → cFe + dCO₂",
    elements: [
      { name: "Fe", leftExpr: "2a", rightExpr: "c", relation: "2a = c" },
      { name: "O", leftExpr: "3a", rightExpr: "2d", relation: "3a = 2d" },
      { name: "C", leftExpr: "b", rightExpr: "d", relation: "b = d" }
    ],
    solution: "c = 2a, d = 3a/2, b = 3a/2; Let a = 2: c = 4, d = 3, b = 3",
    blanks: { a: "2", b: "3", c: "4", d: "3" },
    balanced: "2Fe₂O₃ + 3C → 4Fe + 3CO₂"
  },
  {
    unbalanced: "CaCO₃ → CaO + CO₂",
    variables: "aCaCO₃ → bCaO + cCO₂",
    elements: [
      { name: "Ca", leftExpr: "a", rightExpr: "b", relation: "a = b" },
      { name: "C", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "O", leftExpr: "3a", rightExpr: "b + 2c", relation: "3a = b + 2c" }
    ],
    solution: "a = b = c; 3a = a + 2a ✓; Let a = 1: b = 1, c = 1",
    blanks: { a: "1", b: "1", c: "1" },
    balanced: "CaCO₃ → CaO + CO₂"
  },
  {
    unbalanced: "NaOH + H₂SO₄ → Na₂SO₄ + H₂O",
    variables: "aNaOH + bH₂SO₄ → cNa₂SO₄ + dH₂O",
    elements: [
      { name: "Na", leftExpr: "a", rightExpr: "2c", relation: "a = 2c" },
      { name: "O", leftExpr: "a + 4b", rightExpr: "4c + d", relation: "a + 4b = 4c + d" },
      { name: "H", leftExpr: "a + 2b", rightExpr: "2d", relation: "a + 2b = 2d" },
      { name: "S", leftExpr: "b", rightExpr: "c", relation: "b = c" }
    ],
    solution: "a = 2c, b = c; 2c + 2c = 2d → d = 2c; Let c = 1: a = 2, b = 1, d = 2",
    blanks: { a: "2", b: "1", c: "1", d: "2" },
    balanced: "2NaOH + H₂SO₄ → Na₂SO₄ + 2H₂O"
  },
  {
    unbalanced: "HCl + NaOH → NaCl + H₂O",
    variables: "aHCl + bNaOH → cNaCl + dH₂O",
    elements: [
      { name: "H", leftExpr: "a + b", rightExpr: "2d", relation: "a + b = 2d" },
      { name: "Cl", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "Na", leftExpr: "b", rightExpr: "c", relation: "b = c" },
      { name: "O", leftExpr: "b", rightExpr: "d", relation: "b = d" }
    ],
    solution: "a = b = c = d; Let a = 1: all = 1",
    blanks: { a: "1", b: "1", c: "1", d: "1" },
    balanced: "HCl + NaOH → NaCl + H₂O"
  },
  {
    unbalanced: "Zn + HCl → ZnCl₂ + H₂",
    variables: "aZn + bHCl → cZnCl₂ + dH₂",
    elements: [
      { name: "Zn", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "H", leftExpr: "b", rightExpr: "2d", relation: "b = 2d" },
      { name: "Cl", leftExpr: "b", rightExpr: "2c", relation: "b = 2c" }
    ],
    solution: "a = c, b = 2c = 2d → d = c; Let c = 1: a = 1, b = 2, d = 1",
    blanks: { a: "1", b: "2", c: "1", d: "1" },
    balanced: "Zn + 2HCl → ZnCl₂ + H₂"
  },
  {
    unbalanced: "AgNO₃ + NaCl → AgCl + NaNO₃",
    variables: "aAgNO₃ + bNaCl → cAgCl + dNaNO₃",
    elements: [
      { name: "Ag", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "N", leftExpr: "a", rightExpr: "d", relation: "a = d" },
      { name: "Na", leftExpr: "b", rightExpr: "d", relation: "b = d" },
      { name: "Cl", leftExpr: "b", rightExpr: "c", relation: "b = c" }
    ],
    solution: "a = c = b = d; Let a = 1: all = 1",
    blanks: { a: "1", b: "1", c: "1", d: "1" },
    balanced: "AgNO₃ + NaCl → AgCl + NaNO₃"
  },
  {
    unbalanced: "Cu + AgNO₃ → Cu(NO₃)₂ + Ag",
    variables: "aCu + bAgNO₃ → cCu(NO₃)₂ + dAg",
    elements: [
      { name: "Cu", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "Ag", leftExpr: "b", rightExpr: "d", relation: "b = d" },
      { name: "N", leftExpr: "b", rightExpr: "2c", relation: "b = 2c" }
    ],
    solution: "a = c, b = d = 2c; Let c = 1: a = 1, b = 2, d = 2",
    blanks: { a: "1", b: "2", c: "1", d: "2" },
    balanced: "Cu + 2AgNO₃ → Cu(NO₃)₂ + 2Ag"
  },
  {
    unbalanced: "BaCl₂ + Na₂SO₄ → BaSO₄ + NaCl",
    variables: "aBaCl₂ + bNa₂SO₄ → cBaSO₄ + dNaCl",
    elements: [
      { name: "Ba", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "Cl", leftExpr: "2a", rightExpr: "d", relation: "2a = d" },
      { name: "Na", leftExpr: "2b", rightExpr: "d", relation: "2b = d" },
      { name: "S", leftExpr: "b", rightExpr: "c", relation: "b = c" }
    ],
    solution: "a = b = c, d = 2a; Let a = 1: b = 1, c = 1, d = 2",
    blanks: { a: "1", b: "1", c: "1", d: "2" },
    balanced: "BaCl₂ + Na₂SO₄ → BaSO₄ + 2NaCl"
  },
  {
    unbalanced: "KClO₃ → KCl + O₂",
    variables: "aKClO₃ → bKCl + cO₂",
    elements: [
      { name: "K", leftExpr: "a", rightExpr: "b", relation: "a = b" },
      { name: "Cl", leftExpr: "a", rightExpr: "b", relation: "a = b" },
      { name: "O", leftExpr: "3a", rightExpr: "2c", relation: "3a = 2c" }
    ],
    solution: "a = b, c = 3a/2; Let a = 2: b = 2, c = 3",
    blanks: { a: "2", b: "2", c: "3" },
    balanced: "2KClO₃ → 2KCl + 3O₂"
  },
  {
    unbalanced: "NH₃ + O₂ → NO + H₂O",
    variables: "aNH₃ + bO₂ → cNO + dH₂O",
    elements: [
      { name: "N", leftExpr: "a", rightExpr: "c", relation: "a = c" },
      { name: "H", leftExpr: "3a", rightExpr: "2d", relation: "3a = 2d" },
      { name: "O", leftExpr: "2b", rightExpr: "c + d", relation: "2b = c + d" }
    ],
    solution: "a = c, d = 3a/2; 2b = a + 3a/2 = 5a/2 → b = 5a/4; Let a = 4: c = 4, d = 6, b = 5",
    blanks: { a: "4", b: "5", c: "4", d: "6" },
    balanced: "4NH₃ + 5O₂ → 4NO + 6H₂O"
  },
  {
    unbalanced: "C₄H₁₀ + O₂ → CO₂ + H₂O",
    variables: "aC₄H₁₀ + bO₂ → cCO₂ + dH₂O",
    elements: [
      { name: "C", leftExpr: "4a", rightExpr: "c", relation: "4a = c" },
      { name: "H", leftExpr: "10a", rightExpr: "2d", relation: "10a = 2d → 5a = d" },
      { name: "O", leftExpr: "2b", rightExpr: "2c + d", relation: "2b = 2c + d" }
    ],
    solution: "c = 4a, d = 5a; 2b = 8a + 5a = 13a → b = 13a/2; Let a = 2: c = 8, d = 10, b = 13",
    blanks: { a: "2", b: "13", c: "8", d: "10" },
    balanced: "2C₄H₁₀ + 13O₂ → 8CO₂ + 10H₂O"
  },
  {
    unbalanced: "Fe + H₂O → Fe₃O₄ + H₂",
    variables: "aFe + bH₂O → cFe₃O₄ + dH₂",
    elements: [
      { name: "Fe", leftExpr: "a", rightExpr: "3c", relation: "a = 3c" },
      { name: "H", leftExpr: "2b", rightExpr: "2d", relation: "b = d" },
      { name: "O", leftExpr: "b", rightExpr: "4c", relation: "b = 4c" }
    ],
    solution: "a = 3c, b = d = 4c; Let c = 1: a = 3, b = 4, d = 4",
    blanks: { a: "3", b: "4", c: "1", d: "4" },
    balanced: "3Fe + 4H₂O → Fe₃O₄ + 4H₂"
  },
  {
    unbalanced: "Al + Fe₂O₃ → Al₂O₃ + Fe",
    variables: "aAl + bFe₂O₃ → cAl₂O₃ + dFe",
    elements: [
      { name: "Al", leftExpr: "a", rightExpr: "2c", relation: "a = 2c" },
      { name: "Fe", leftExpr: "2b", rightExpr: "d", relation: "2b = d" },
      { name: "O", leftExpr: "3b", rightExpr: "3c", relation: "3b = 3c → b = c" }
    ],
    solution: "a = 2c, b = c, d = 2b = 2c; Let c = 1: a = 2, b = 1, d = 2",
    blanks: { a: "2", b: "1", c: "1", d: "2" },
    balanced: "2Al + Fe₂O₃ → Al₂O₃ + 2Fe"
  }
];

// ============================================================================
// PRACTICE PROBLEMS DATA (25 problems)
// ============================================================================
const practiceProblems = [
  {
    unbalanced: "Li + O₂ → Li₂O",
    compounds: ["Li", "O₂", "Li₂O"],
    coefficients: [4, 1, 2],
    solution: {
      variables: "aLi + bO₂ → cLi₂O",
      equations: ["Li: a = 2c", "O: 2b = c"],
      steps: "a = 2c, c = 2b → a = 4b; Let b = 1: a = 4, c = 2",
      balanced: "4Li + O₂ → 2Li₂O"
    }
  },
  {
    unbalanced: "K + Br₂ → KBr",
    compounds: ["K", "Br₂", "KBr"],
    coefficients: [2, 1, 2],
    solution: {
      variables: "aK + bBr₂ → cKBr",
      equations: ["K: a = c", "Br: 2b = c"],
      steps: "a = c = 2b; Let b = 1: a = 2, c = 2",
      balanced: "2K + Br₂ → 2KBr"
    }
  },
  {
    unbalanced: "Ca + N₂ → Ca₃N₂",
    compounds: ["Ca", "N₂", "Ca₃N₂"],
    coefficients: [3, 1, 1],
    solution: {
      variables: "aCa + bN₂ → cCa₃N₂",
      equations: ["Ca: a = 3c", "N: 2b = 2c → b = c"],
      steps: "a = 3c, b = c; Let c = 1: a = 3, b = 1",
      balanced: "3Ca + N₂ → Ca₃N₂"
    }
  },
  {
    unbalanced: "Fe + S → FeS",
    compounds: ["Fe", "S", "FeS"],
    coefficients: [1, 1, 1],
    solution: {
      variables: "aFe + bS → cFeS",
      equations: ["Fe: a = c", "S: b = c"],
      steps: "a = b = c; Let a = 1: all = 1",
      balanced: "Fe + S → FeS"
    }
  },
  {
    unbalanced: "H₂ + N₂ → NH₃",
    compounds: ["H₂", "N₂", "NH₃"],
    coefficients: [3, 1, 2],
    solution: {
      variables: "aH₂ + bN₂ → cNH₃",
      equations: ["H: 2a = 3c", "N: 2b = c"],
      steps: "c = 2b, 2a = 6b → a = 3b; Let b = 1: a = 3, c = 2",
      balanced: "3H₂ + N₂ → 2NH₃"
    }
  },
  {
    unbalanced: "C₂H₄ + O₂ → CO₂ + H₂O",
    compounds: ["C₂H₄", "O₂", "CO₂", "H₂O"],
    coefficients: [1, 3, 2, 2],
    solution: {
      variables: "aC₂H₄ + bO₂ → cCO₂ + dH₂O",
      equations: ["C: 2a = c", "H: 4a = 2d → 2a = d", "O: 2b = 2c + d"],
      steps: "c = 2a, d = 2a; 2b = 4a + 2a = 6a → b = 3a; Let a = 1: c = 2, d = 2, b = 3",
      balanced: "C₂H₄ + 3O₂ → 2CO₂ + 2H₂O"
    }
  },
  {
    unbalanced: "Al + HCl → AlCl₃ + H₂",
    compounds: ["Al", "HCl", "AlCl₃", "H₂"],
    coefficients: [2, 6, 2, 3],
    solution: {
      variables: "aAl + bHCl → cAlCl₃ + dH₂",
      equations: ["Al: a = c", "H: b = 2d", "Cl: b = 3c"],
      steps: "a = c, b = 3c = 2d → d = 3c/2; Let c = 2: a = 2, b = 6, d = 3",
      balanced: "2Al + 6HCl → 2AlCl₃ + 3H₂"
    }
  },
  {
    unbalanced: "Mg + HCl → MgCl₂ + H₂",
    compounds: ["Mg", "HCl", "MgCl₂", "H₂"],
    coefficients: [1, 2, 1, 1],
    solution: {
      variables: "aMg + bHCl → cMgCl₂ + dH₂",
      equations: ["Mg: a = c", "H: b = 2d", "Cl: b = 2c"],
      steps: "a = c, b = 2c = 2d → d = c; Let c = 1: a = 1, b = 2, d = 1",
      balanced: "Mg + 2HCl → MgCl₂ + H₂"
    }
  },
  {
    unbalanced: "Na₂CO₃ + HCl → NaCl + H₂O + CO₂",
    compounds: ["Na₂CO₃", "HCl", "NaCl", "H₂O", "CO₂"],
    coefficients: [1, 2, 2, 1, 1],
    solution: {
      variables: "aNa₂CO₃ + bHCl → cNaCl + dH₂O + eCO₂",
      equations: ["Na: 2a = c", "C: a = e", "O: 3a = d + 2e", "H: b = 2d", "Cl: b = c"],
      steps: "c = 2a, e = a, d + 2a = 3a → d = a, b = 2a; Let a = 1: c = 2, e = 1, d = 1, b = 2",
      balanced: "Na₂CO₃ + 2HCl → 2NaCl + H₂O + CO₂"
    }
  },
  {
    unbalanced: "C₆H₁₂O₆ → C₂H₅OH + CO₂",
    compounds: ["C₆H₁₂O₆", "C₂H₅OH", "CO₂"],
    coefficients: [1, 2, 2],
    solution: {
      variables: "aC₆H₁₂O₆ → bC₂H₅OH + cCO₂",
      equations: ["C: 6a = 2b + c", "H: 12a = 6b", "O: 6a = b + 2c"],
      steps: "12a = 6b → b = 2a; 6a = 4a + c → c = 2a; Let a = 1: b = 2, c = 2",
      balanced: "C₆H₁₂O₆ → 2C₂H₅OH + 2CO₂"
    }
  },
  {
    unbalanced: "NH₄NO₃ → N₂O + H₂O",
    compounds: ["NH₄NO₃", "N₂O", "H₂O"],
    coefficients: [1, 1, 2],
    solution: {
      variables: "aNH₄NO₃ → bN₂O + cH₂O",
      equations: ["N: 2a = 2b → a = b", "H: 4a = 2c → 2a = c", "O: 3a = b + c"],
      steps: "a = b, c = 2a; 3a = a + 2a ✓; Let a = 1: b = 1, c = 2",
      balanced: "NH₄NO₃ → N₂O + 2H₂O"
    }
  },
  {
    unbalanced: "Pb(NO₃)₂ → PbO + NO₂ + O₂",
    compounds: ["Pb(NO₃)₂", "PbO", "NO₂", "O₂"],
    coefficients: [2, 2, 4, 1],
    solution: {
      variables: "aPb(NO₃)₂ → bPbO + cNO₂ + dO₂",
      equations: ["Pb: a = b", "N: 2a = c", "O: 6a = b + 2c + 2d"],
      steps: "a = b, c = 2a; 6a = a + 4a + 2d → d = a/2; Let a = 2: b = 2, c = 4, d = 1",
      balanced: "2Pb(NO₃)₂ → 2PbO + 4NO₂ + O₂"
    }
  },
  {
    unbalanced: "H₂S + O₂ → SO₂ + H₂O",
    compounds: ["H₂S", "O₂", "SO₂", "H₂O"],
    coefficients: [2, 3, 2, 2],
    solution: {
      variables: "aH₂S + bO₂ → cSO₂ + dH₂O",
      equations: ["H: 2a = 2d → a = d", "S: a = c", "O: 2b = 2c + d"],
      steps: "a = c = d; 2b = 2a + a = 3a → b = 3a/2; Let a = 2: c = 2, d = 2, b = 3",
      balanced: "2H₂S + 3O₂ → 2SO₂ + 2H₂O"
    }
  },
  {
    unbalanced: "FeS₂ + O₂ → Fe₂O₃ + SO₂",
    compounds: ["FeS₂", "O₂", "Fe₂O₃", "SO₂"],
    coefficients: [4, 11, 2, 8],
    solution: {
      variables: "aFeS₂ + bO₂ → cFe₂O₃ + dSO₂",
      equations: ["Fe: a = 2c", "S: 2a = d", "O: 2b = 3c + 2d"],
      steps: "a = 2c, d = 4c; 2b = 3c + 8c = 11c → b = 11c/2; Let c = 2: a = 4, d = 8, b = 11",
      balanced: "4FeS₂ + 11O₂ → 2Fe₂O₃ + 8SO₂"
    }
  },
  {
    unbalanced: "SiO₂ + C → Si + CO",
    compounds: ["SiO₂", "C", "Si", "CO"],
    coefficients: [1, 2, 1, 2],
    solution: {
      variables: "aSiO₂ + bC → cSi + dCO",
      equations: ["Si: a = c", "O: 2a = d", "C: b = d"],
      steps: "a = c, d = 2a = b; Let a = 1: c = 1, d = 2, b = 2",
      balanced: "SiO₂ + 2C → Si + 2CO"
    }
  },
  {
    unbalanced: "PCl₅ + H₂O → H₃PO₄ + HCl",
    compounds: ["PCl₅", "H₂O", "H₃PO₄", "HCl"],
    coefficients: [1, 4, 1, 5],
    solution: {
      variables: "aPCl₅ + bH₂O → cH₃PO₄ + dHCl",
      equations: ["P: a = c", "Cl: 5a = d", "H: 2b = 3c + d", "O: b = 4c"],
      steps: "a = c, d = 5a, b = 4a; 8a = 3a + 5a ✓; Let a = 1: c = 1, d = 5, b = 4",
      balanced: "PCl₅ + 4H₂O → H₃PO₄ + 5HCl"
    }
  },
  {
    unbalanced: "Ca(OH)₂ + H₃PO₄ → Ca₃(PO₄)₂ + H₂O",
    compounds: ["Ca(OH)₂", "H₃PO₄", "Ca₃(PO₄)₂", "H₂O"],
    coefficients: [3, 2, 1, 6],
    solution: {
      variables: "aCa(OH)₂ + bH₃PO₄ → cCa₃(PO₄)₂ + dH₂O",
      equations: ["Ca: a = 3c", "P: b = 2c", "O: 2a + 4b = 8c + d", "H: 2a + 3b = 2d"],
      steps: "a = 3c, b = 2c; 6c + 6c = 2d → d = 6c; Let c = 1: a = 3, b = 2, d = 6",
      balanced: "3Ca(OH)₂ + 2H₃PO₄ → Ca₃(PO₄)₂ + 6H₂O"
    }
  },
  {
    unbalanced: "Cr₂O₃ + Al → Al₂O₃ + Cr",
    compounds: ["Cr₂O₃", "Al", "Al₂O₃", "Cr"],
    coefficients: [1, 2, 1, 2],
    solution: {
      variables: "aCr₂O₃ + bAl → cAl₂O₃ + dCr",
      equations: ["Cr: 2a = d", "O: 3a = 3c → a = c", "Al: b = 2c"],
      steps: "a = c, d = 2a, b = 2a; Let a = 1: c = 1, d = 2, b = 2",
      balanced: "Cr₂O₃ + 2Al → Al₂O₃ + 2Cr"
    }
  },
  {
    unbalanced: "C₅H₁₂ + O₂ → CO₂ + H₂O",
    compounds: ["C₅H₁₂", "O₂", "CO₂", "H₂O"],
    coefficients: [1, 8, 5, 6],
    solution: {
      variables: "aC₅H₁₂ + bO₂ → cCO₂ + dH₂O",
      equations: ["C: 5a = c", "H: 12a = 2d → 6a = d", "O: 2b = 2c + d"],
      steps: "c = 5a, d = 6a; 2b = 10a + 6a = 16a → b = 8a; Let a = 1: c = 5, d = 6, b = 8",
      balanced: "C₅H₁₂ + 8O₂ → 5CO₂ + 6H₂O"
    }
  },
  {
    unbalanced: "FeCl₃ + NaOH → Fe(OH)₃ + NaCl",
    compounds: ["FeCl₃", "NaOH", "Fe(OH)₃", "NaCl"],
    coefficients: [1, 3, 1, 3],
    solution: {
      variables: "aFeCl₃ + bNaOH → cFe(OH)₃ + dNaCl",
      equations: ["Fe: a = c", "Cl: 3a = d", "Na: b = d", "O: b = 3c"],
      steps: "a = c, d = 3a = b; Let a = 1: c = 1, d = 3, b = 3",
      balanced: "FeCl₃ + 3NaOH → Fe(OH)₃ + 3NaCl"
    }
  },
  {
    unbalanced: "MnO₂ + HCl → MnCl₂ + Cl₂ + H₂O",
    compounds: ["MnO₂", "HCl", "MnCl₂", "Cl₂", "H₂O"],
    coefficients: [1, 4, 1, 1, 2],
    solution: {
      variables: "aMnO₂ + bHCl → cMnCl₂ + dCl₂ + eH₂O",
      equations: ["Mn: a = c", "O: 2a = e", "H: b = 2e", "Cl: b = 2c + 2d"],
      steps: "a = c, e = 2a, b = 4a; 4a = 2a + 2d → d = a; Let a = 1: c = 1, e = 2, b = 4, d = 1",
      balanced: "MnO₂ + 4HCl → MnCl₂ + Cl₂ + 2H₂O"
    }
  },
  {
    unbalanced: "Cu₂S + O₂ → Cu₂O + SO₂",
    compounds: ["Cu₂S", "O₂", "Cu₂O", "SO₂"],
    coefficients: [2, 3, 2, 2],
    solution: {
      variables: "aCu₂S + bO₂ → cCu₂O + dSO₂",
      equations: ["Cu: 2a = 2c → a = c", "S: a = d", "O: 2b = c + 2d"],
      steps: "a = c = d; 2b = a + 2a = 3a → b = 3a/2; Let a = 2: c = 2, d = 2, b = 3",
      balanced: "2Cu₂S + 3O₂ → 2Cu₂O + 2SO₂"
    }
  },
  {
    unbalanced: "Mg₃N₂ + H₂O → Mg(OH)₂ + NH₃",
    compounds: ["Mg₃N₂", "H₂O", "Mg(OH)₂", "NH₃"],
    coefficients: [1, 6, 3, 2],
    solution: {
      variables: "aMg₃N₂ + bH₂O → cMg(OH)₂ + dNH₃",
      equations: ["Mg: 3a = c", "N: 2a = d", "H: 2b = 2c + 3d", "O: b = 2c"],
      steps: "c = 3a, d = 2a, b = 6a; 12a = 6a + 6a ✓; Let a = 1: c = 3, d = 2, b = 6",
      balanced: "Mg₃N₂ + 6H₂O → 3Mg(OH)₂ + 2NH₃"
    }
  },
  {
    unbalanced: "KMnO₄ + HCl → KCl + MnCl₂ + Cl₂ + H₂O",
    compounds: ["KMnO₄", "HCl", "KCl", "MnCl₂", "Cl₂", "H₂O"],
    coefficients: [2, 16, 2, 2, 5, 8],
    solution: {
      variables: "aKMnO₄ + bHCl → cKCl + dMnCl₂ + eCl₂ + fH₂O",
      equations: ["K: a = c", "Mn: a = d", "O: 4a = f", "H: b = 2f", "Cl: b = c + 2d + 2e"],
      steps: "c = d = a, f = 4a, b = 8a; 8a = a + 2a + 2e → e = 5a/2; Let a = 2: c = d = 2, f = 8, b = 16, e = 5",
      balanced: "2KMnO₄ + 16HCl → 2KCl + 2MnCl₂ + 5Cl₂ + 8H₂O"
    }
  },
  {
    unbalanced: "C₆H₆ + O₂ → CO₂ + H₂O",
    compounds: ["C₆H₆", "O₂", "CO₂", "H₂O"],
    coefficients: [2, 15, 12, 6],
    solution: {
      variables: "aC₆H₆ + bO₂ → cCO₂ + dH₂O",
      equations: ["C: 6a = c", "H: 6a = 2d → 3a = d", "O: 2b = 2c + d"],
      steps: "c = 6a, d = 3a; 2b = 12a + 3a = 15a → b = 15a/2; Let a = 2: c = 12, d = 6, b = 15",
      balanced: "2C₆H₆ + 15O₂ → 12CO₂ + 6H₂O"
    }
  }
];

// ============================================================================
// RENDERING FUNCTIONS
// ============================================================================

function renderWorkedExamples() {
  const container = document.getElementById('worked-examples');
  container.innerHTML = workedExamples.map((ex, idx) => {
    const stepsHTML = ex.steps.map(step => {
      let content = '';
      if (step.equations) {
        content = `<ul>${step.equations.map(eq =>
          `<li><strong>${eq.element}:</strong> Left = ${eq.left}, Right = ${eq.right} → <em>${eq.equation}</em></li>`
        ).join('')}</ul>`;
      } else {
        content = `<p style="white-space: pre-line;">${step.content}</p>`;
      }
      return `
        <div class="step-box">
          <h4>${step.name}</h4>
          ${content}
        </div>
      `;
    }).join('');

    const verificationRows = ex.verification.map(v =>
      `<tr><td>${v.element}</td><td>${v.left}</td><td>${v.right}</td><td>✓</td></tr>`
    ).join('');

    return `
      <div class="example-card">
        <h3>${ex.title}</h3>
        <div class="equation-display">
          <strong>Unbalanced:</strong> ${ex.unbalanced}
        </div>
        ${stepsHTML}
        <div class="final-answer">${ex.balanced}</div>
        <div class="info-box info-box-gold mt-2">
          <strong>Verification:</strong>
          <table class="atom-count-table">
            <tr><th>Element</th><th>Left Side</th><th>Right Side</th><th>Balanced?</th></tr>
            ${verificationRows}
          </table>
        </div>
      </div>
    `;
  }).join('');
}

function renderGuidedProblems() {
  const container = document.getElementById('guided-problems');
  container.innerHTML = guidedProblems.map((p, idx) => {
    const elementsHTML = p.elements.map(el =>
      `<li><strong>${el.name}:</strong> ${el.leftExpr} = ${el.rightExpr} → <em>${el.relation}</em></li>`
    ).join('');

    const blanksHTML = Object.entries(p.blanks).map(([varName, value]) =>
      `<div style="display: inline-flex; align-items: center; margin: 0.25rem 0.5rem;">
        <span style="margin-right: 0.25rem;">${varName} = </span>
        <input type="text" class="blank-input" id="guided-${idx}-${varName}" data-answer="${value}">
      </div>`
    ).join('');

    return `
      <div class="problem card">
        <span class="problem-number">${idx + 1}.</span>
        <div class="equation-display">
          <strong>Balance:</strong> ${p.unbalanced}
        </div>

        <div class="step-box">
          <h4>Step 1: Assign Variables</h4>
          <div class="math-display">${p.variables}</div>
        </div>

        <div class="step-box">
          <h4>Step 2: Element Equations</h4>
          <ul>${elementsHTML}</ul>
        </div>

        <div class="step-box">
          <h4>Step 3 & 4: Solve and Find Coefficients</h4>
          <p><em>${p.solution}</em></p>
          <div style="margin-top: 0.75rem;">
            <strong>Fill in the coefficients:</strong><br>
            ${blanksHTML}
          </div>
        </div>

        <div class="buttons">
          <button class="btn btn-primary" onclick="checkGuided(${idx})">Check</button>
          <button class="btn btn-secondary" onclick="showSolution('guided-sol-${idx}')">Show Answer</button>
        </div>

        <div id="guided-sol-${idx}" class="solution">
          <span class="solution-label">Answer:</span><br>
          <div class="final-answer">${p.balanced}</div>
        </div>
      </div>
    `;
  }).join('');
}

function renderPracticeProblems() {
  const container = document.getElementById('practice-problems');
  container.innerHTML = practiceProblems.map((p, idx) => {
    const inputsHTML = p.compounds.map((compound, cIdx) => {
      const isLast = cIdx === p.compounds.length - 1;
      const separator = cIdx < p.compounds.length - 1 ?
        (cIdx === 0 || (p.compounds.length > 3 && cIdx < p.compounds.length - 2) ? ' + ' : ' → ') : '';

      // Determine separator based on position
      let sep = '';
      if (cIdx < p.compounds.length - 1) {
        // Find where products start (after arrow)
        const arrowPos = p.unbalanced.indexOf('→');
        const compoundInReactants = p.unbalanced.indexOf(compound.replace(/[₀₁₂₃₄₅₆₇₈₉]/g, match => {
          const map = {'₀':'0','₁':'1','₂':'2','₃':'3','₄':'4','₅':'5','₆':'6','₇':'7','₈':'8','₉':'9'};
          return map[match];
        })) < arrowPos;

        // Check next compound position
        const nextCompound = p.compounds[cIdx + 1];
        const nextInReactants = p.unbalanced.indexOf(nextCompound.replace(/[₀₁₂₃₄₅₆₇₈₉]/g, match => {
          const map = {'₀':'0','₁':'1','₂':'2','₃':'3','₄':'4','₅':'5','₆':'6','₇':'7','₈':'8','₉':'9'};
          return map[match];
        })) < arrowPos;

        sep = compoundInReactants === nextInReactants ? ' + ' : ' → ';
      }

      return `<input type="text" class="coefficient-input" id="practice-${idx}-${cIdx}" data-answer="${p.coefficients[cIdx]}"><span>${compound}</span>${sep}`;
    }).join('');

    const eqnsHTML = p.solution.equations.map(eq => `<li>${eq}</li>`).join('');

    return `
      <div class="problem card">
        <span class="problem-number">${idx + 1}.</span>
        <div class="equation-display">
          <strong>Balance:</strong> ${p.unbalanced}
        </div>

        <div class="equation-workspace">
          ${inputsHTML}
        </div>

        <div class="buttons">
          <button class="btn btn-primary" onclick="checkPractice(${idx})">Check</button>
          <button class="btn btn-secondary" onclick="showSolution('practice-sol-${idx}')">Show Solution</button>
        </div>

        <div id="practice-sol-${idx}" class="solution">
          <span class="solution-label">Solution:</span>
          <div class="step-box">
            <h4>Variables</h4>
            <p>${p.solution.variables}</p>
          </div>
          <div class="step-box">
            <h4>Element Equations</h4>
            <ul>${eqnsHTML}</ul>
          </div>
          <div class="step-box">
            <h4>Solving</h4>
            <p>${p.solution.steps}</p>
          </div>
          <div class="final-answer">${p.solution.balanced}</div>
        </div>
      </div>
    `;
  }).join('');
}

// ============================================================================
// CHECKING FUNCTIONS
// ============================================================================

function checkGuided(idx) {
  const p = guidedProblems[idx];
  Object.entries(p.blanks).forEach(([varName, answer]) => {
    checkInput(`guided-${idx}-${varName}`, answer);
  });
}

function checkPractice(idx) {
  const p = practiceProblems[idx];
  p.coefficients.forEach((coef, cIdx) => {
    checkInput(`practice-${idx}-${cIdx}`, coef.toString());
  });
}

function checkInput(id, correctAnswer) {
  const input = document.getElementById(id);
  const userValue = input.value.trim();
  const correct = String(correctAnswer);

  let isCorrect = false;

  if (userValue === correct) {
    isCorrect = true;
  } else {
    const userNum = parseFloat(userValue);
    const correctNum = parseFloat(correct);
    if (!isNaN(userNum) && !isNaN(correctNum) && userNum === correctNum) {
      isCorrect = true;
    }
  }

  input.classList.remove('correct', 'incorrect');
  input.classList.add(isCorrect ? 'correct' : 'incorrect');
}

function showSolution(id) {
  const sol = document.getElementById(id);
  sol.classList.toggle('show');
}

function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');
}

// ============================================================================
// INITIALIZE
// ============================================================================
renderWorkedExamples();
renderGuidedProblems();
renderPracticeProblems();
</script>
  <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="mahaque" data-description="Support me on Buy me a coffee!" data-message="I hope these resources helped you! It takes me a while to come up with ways to help students succeed, so your support is greatly appreciated!" data-color="#40DCA5" data-position="Right" data-x_margin="18" data-y_margin="18"></script>
</body>
</html>
